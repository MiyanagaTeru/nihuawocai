{"version":3,"sources":["webpack:///webpack/bootstrap 77b5cf7e890e6c8438a5","webpack:///./server.js","webpack:///./~/script-loader/addScript.js","webpack:///./server.js?16ad"],"names":[],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA,mDAA2C,cAAc;;AAEzD;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;AChEA,mDAAmD,sBAAsB,yCAAyC,sCAAsC,mDAAmD,kCAAkC,4CAA4C,GAAG,EAAE,iCAAiC,uCAAuC,GAAG,EAAE,0BAA0B,gBAAgB,iBAAiB,6BAA6B,yBAAyB,6CAA6C,6BAA6B,qBAAqB,wBAAwB,yCAAyC,oGAAoG,uBAAuB,yDAAyD,EAAE,oCAAoC,sBAAsB,EAAE,6BAA6B,eAAe,EAAE,oFAAoF,gCAAgC,sCAAsC,GAAG,KAAK,oCAAoC,sBAAsB,EAAE,mFAAmF,yBAAyB,sCAAsC,eAAe,EAAE,KAAK,EAAE,sEAAsE,mCAAmC,4BAA4B,gCAAgC,EAAE,KAAK,EAAE,gDAAgD,gDAAgD,EAAE,oDAAoD,2EAA2E,+BAA+B,eAAe,EAAE,yBAAyB,kEAAkE,EAAE,sCAAsC,sBAAsB,EAAE,KAAK,EAAE,8DAA8D,+DAA+D,+BAA+B,eAAe,EAAE,wCAAwC,2BAA2B,OAAO,IAAI,6CAA6C,wBAAwB,+CAA+C,+BAA+B,WAAW,8EAA8E,4BAA4B,uCAAuC,sCAAsC,sCAAsC,GAAG,WAAW,oCAAoC,6EAA6E,EAAE,iEAAiE,mCAAmC,aAAa,EAAE,4BAA4B,+DAA+D,kCAAkC,yCAAyC,+BAA+B,qCAAqC,wCAAwC,EAAE,kEAAkE,yCAAyC,aAAa,EAAE,oCAAoC,eAAe,0FAA0F,iCAAiC,EAAE,gCAAgC,yCAAyC,+BAA+B,2CAA2C,wCAAwC,EAAE,kEAAkE,yCAAyC,aAAa,EAAE,oCAAoC,eAAe,4CAA4C,qBAAqB,EAAE,4BAA4B,aAAa,qCAAqC,OAAO,OAAO,EAAE,mEAAmE,qFAAqF,2BAA2B,oGAAoG,EAAE,wCAAwC,sBAAsB,EAAE,wCAAwC,6CAA6C,iFAAiF,6EAA6E,wDAAwD,6CAA6C,aAAa,oFAAoF,mLAAmL,eAAe,EAAE,SAAS,OAAO,OAAO,2BAA2B,gDAAgD,EAAE,wCAAwC,sBAAsB,EAAE,OAAO,KAAK,EAAE,2DAA2D,yBAAyB,gCAAgC,oCAAoC,6CAA6C,EAAE,sCAAsC,sBAAsB,EAAE,2CAA2C,0CAA0C,OAAO,EAAE,+BAA+B,eAAe,EAAE,KAAK,EAAE,GAAG,EAAE,0DAA0D,6BAA6B,wCAAwC,+BAA+B,SAAS,aAAa,EAAE,OAAO,EAAE,KAAK,0DAA0D,uCAAuC,KAAK,EAAE,iCAAiC,2FAA2F,2BAA2B,cAAc,iGAAiG,OAAO,+BAA+B,iCAAiC,EAAE,KAAK,GAAG,K;;;;;;ACAl+L;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;ACTA,8C","file":"index_bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// identity function for calling harmony imports with the correct context\n \t__webpack_require__.i = function(value) { return value; };\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 2);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 77b5cf7e890e6c8438a5","module.exports = \"var express = require('express');\\nvar app = express();\\nvar http = require('http').Server(app);\\nvar io = require('socket.io')(http);\\n\\napp.use(express.static(__dirname + '/public'));\\napp.get('/', function(req, res){\\n\\tres.sendFile(__dirname + '/index.html');\\n});\\n\\nhttp.listen(8848, function(){\\n\\tconsole.log('listening on *:8848');\\n});\\n\\nvar line_history = [];\\nvar ratio = 1;\\nvar users = [];\\nvar numberOfReadyUsers = 0;\\nvar currentUserIdx = 0;\\nvar questions = [\\n\\t'大象', '苹果', '舞法天女'\\n];\\nvar currentQuestionIdx = 0;\\nvar gaming = false;\\nvar chat_message = [];\\n\\nio.on('connection', function(socket){\\n\\t// add user to user list\\n\\tusers = updateUsers(users, socket.id, 'username', '一位不愿意透露姓名的舞法天女');\\n\\tchat_message.push({user: '一位不愿意透露姓名的舞法天女', message: '加入了房间', type: 'system'});\\n\\tio.emit('update_chat_content', {content: chat_message});\\n\\tio.emit('update_users', { users: users });\\n\\t// drawing part\\n\\t/// keep new user up-to-date\\n\\tfor (var i in line_history) {\\n\\t\\tsocket.emit('draw_line', { line: line_history[i], ratio: ratio } );\\n\\t}\\n\\tio.emit('update_chat_content', {content: chat_message});\\n\\n\\t/// update drawer ratio\\n\\tsocket.on('update_drawer_ratio', function (data) {\\n\\t\\tratio = data.ratio;\\n\\t\\tio.emit('update_drawer_ratio', { ratio: ratio });\\n\\t});\\n\\n\\t/// handle draw_line\\n\\tsocket.on('draw_line', function (data) {\\n\\t\\tline_history.push(data.line);\\n\\t\\tio.emit('draw_line', { line: data.line, ratio: ratio });\\n\\t});\\n\\n\\t// user part\\n\\tsocket.emit('init_user', {socketId: socket.id, username: '一位不愿意透露姓名的舞法天女'});\\n\\n\\tsocket.on('update_username', function (data) {\\n\\t\\tusers = updateUsers(users, data.socketId, 'username', data.newName );\\n\\t\\tio.emit('update_users', { users: users });\\n\\t\\tchat_message.push({user: data.oldName, message: '将名字改为'+data.newName, type: 'system'});\\n\\t\\tio.emit('update_chat_content', {content: chat_message});\\n\\t});\\n\\n\\t// gameplay\\n\\tsocket.on('user_ready', function (data) {\\n\\t\\tusers = updateUsers(users, data.socketId, 'ready', true);\\n\\t\\tio.emit('update_users', { users: users });\\n\\n\\t\\tif (!users.find(function(user) {\\n\\t\\t\\treturn !user.ready;\\n\\t\\t})) {\\n\\t\\t\\t// start game\\n\\t\\t\\t\\tif (!gaming) {\\n\\t\\t\\t\\tgaming = true;\\n\\t\\t\\t\\tif (currentUserIdx >= users.length) {\\n\\t\\t\\t\\t\\tcurrentUserIdx = 0;\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tcurrentQuestionIdx = Math.floor((Math.random() * questions.length));\\n\\t\\t\\t\\tline_history = [];\\n\\t\\t\\t\\tfor (var i in line_history) {\\n\\t\\t\\t\\t\\tsocket.emit('draw_line', { line: line_history[i], ratio: ratio } );\\n\\t\\t\\t\\t}\\n\\t\\t\\t\\tio.emit('clear_and_set', { question: questions[currentQuestionIdx], currentUser: users[currentUserIdx]});\\n\\t\\t\\t\\tusers = updateUsers(users, 'all', 'guess', 'guessing');\\n\\t\\t\\t\\tio.emit('update_users', {users: users});\\n\\t\\t\\t\\tvar leftTime = 40;\\n\\t\\t\\t\\tvar gameTimer = setInterval(\\n\\t\\t\\t\\t\\tfunction () {\\n\\t\\t\\t\\t\\t\\tif (leftTime <= 0) {\\n\\t\\t\\t\\t\\t\\t\\tclearInterval(gameTimer);\\n\\t\\t\\t\\t\\t\\t\\tgaming = false;\\n\\t\\t\\t\\t\\t\\t\\tio.emit('game_end', {question: questions[currentQuestionIdx]});\\n\\t\\t\\t\\t\\t\\t\\tusers = updateUsers(users, 'all', 'ready', false);\\n\\t\\t\\t\\t\\t\\t\\tio.emit('update_users', {users: users});\\n\\t\\t\\t\\t\\t\\t\\tcurrentUserIdx += 1;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\t// all guessed correct\\n\\t\\t\\t\\t\\t\\telse if (users.filter( function (user) { return user.guess === 'correct'; }).length === users.length - 1) {\\n\\t\\t\\t\\t\\t\\t\\tclearInterval(gameTimer);\\n\\t\\t\\t\\t\\t\\t\\tgaming = false;\\n\\t\\t\\t\\t\\t\\t\\tio.emit('game_end_early', {question: questions[currentQuestionIdx]});\\n\\t\\t\\t\\t\\t\\t\\tusers = updateUsers(users, 'all', 'ready', false);\\n\\t\\t\\t\\t\\t\\t\\tio.emit('update_users', {users: users});\\n\\t\\t\\t\\t\\t\\t\\tcurrentUserIdx += 1;\\n\\t\\t\\t\\t\\t\\t}\\n\\t\\t\\t\\t\\t\\tio.emit('update_game_timer', { leftTime: leftTime });\\n\\t\\t\\t\\t\\t\\tleftTime -= 1;\\n\\t\\t\\t\\t\\t},\\n\\t\\t\\t\\t\\t1000\\n\\t\\t\\t\\t)\\n\\t\\t\\t}\\n\\t\\t}\\n\\n\\t});\\n\\n\\n\\t// chat part\\n\\tsocket.on('chat_message', function (data) {\\n\\t\\t// correct\\n\\t\\tif (data.message === questions[currentQuestionIdx] && gaming) {\\n\\t\\t\\tchat_message.push({user: data.user.username, message: data.message + '（你猜对了！这条信息对其他人隐藏）', socketId: data.user.socketId});\\n\\t\\t\\tio.emit('update_chat_content', {content: chat_message});\\n\\t\\t\\tif ( users.find(function(user) { return user.socketId === data.user.socketId}).guess !== 'correct' && data.user.socketId !== users[currentUserIdx].socketId) {\\n\\t\\t\\t\\tusers = updateUsers(users, data.user.socketId, 'guess', 'correct');\\n\\t\\t\\t\\tvar currentScore = users.find(function(user) { return user.socketId === data.user.socketId}).score || 0;\\n\\t\\t\\t\\tusers = updateUsers(users, data.user.socketId, 'score', currentScore + 1);\\n\\t\\t\\t\\tusers = updateUsers(users, users[currentUserIdx].socketId, 'score', users[currentUserIdx].score ? users[currentUserIdx].score + 1 : 1)\\n\\t\\t\\t\\tio.emit('update_users', { users: users });\\n\\t\\t\\t}\\n\\t\\t} else {\\n\\t\\t\\tchat_message.push({user: data.user.username, message: data.message});\\n\\t\\t\\tio.emit('update_chat_content', {content: chat_message});\\n\\t\\t}\\n\\t});\\n\\n\\t// disconnect\\n\\tsocket.on('disconnect', function() {\\n\\t\\tchat_message.push({user: users.find(function(obj) { return obj.socketId === socket.id }).username, message: '离开了房间', type: 'system'});\\n\\t\\tio.emit('update_chat_content', {content: chat_message});\\n\\t\\tusers = users.filter( function(obj) {\\n\\t\\t\\treturn obj.socketId !== socket.id;\\n\\t\\t});\\n\\t\\tio.emit('update_users', { users: users });\\n\\t});\\n});\\n\\n\\nfunction updateUsers (users, socketId, key, value) {\\n\\tif (socketId === 'all') {\\n\\t\\treturn users.map( function(user) {\\n\\t\\t\\treturn Object.assign({}, user, {[key]: value});\\n\\t\\t});\\n\\t}\\n\\tvar targetUserIndex = users.findIndex( function(obj) {\\n\\t\\treturn obj.socketId === socketId;\\n\\t});\\n\\n\\tif (targetUserIndex > -1) {\\n\\t\\treturn [].concat(\\n\\t\\t\\t\\tusers.slice(0, targetUserIndex),\\n\\t\\t\\t\\tObject.assign({}, users[targetUserIndex], { [key]: value} ),\\n\\t\\t\\t\\ttargetUserIndex < users.length ? users.slice(targetUserIndex + 1) : ''\\n\\t\\t\\t)\\n\\t} else {\\n\\t\\treturn [].concat(users, {socketId: socketId, [key]: value});\\n\\t}\\n}\\n\\n\"\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/raw-loader!./server.js\n// module id = 0\n// module chunks = 0","/*\r\n\tMIT License http://www.opensource.org/licenses/mit-license.php\r\n\tAuthor Tobias Koppers @sokra\r\n*/\r\nmodule.exports = function(src) {\r\n\tif (typeof execScript !== \"undefined\")\r\n\t\texecScript(src);\r\n\telse\r\n\t\teval.call(null, src);\r\n}\r\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/script-loader/addScript.js\n// module id = 1\n// module chunks = 0","require(\"!!/Users/sli/test/chat/node_modules/script-loader/addScript.js\")(require(\"!!/Users/sli/test/chat/node_modules/raw-loader/index.js!/Users/sli/test/chat/server.js\"))\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server.js\n// module id = 2\n// module chunks = 0"],"sourceRoot":""}